<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ソフトウェアテスト学習ガイド</title>
    <style>
        body {
            font-family: sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
            border-radius: 8px;
        }
        h1, h2, h3 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        code {
            background-color: #eee;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }
        pre {
            background-color: #f0f0f0;
            color: #333;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        ul {
            list-style-type: disc;
            padding-left: 20px;
        }
        li {
            margin-bottom: 10px;
        }
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 15px;
            }
        }
        /* Quiz Styles */
        .quiz-question {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        .quiz-options label {
            display: block;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .quiz-question button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        .quiz-question button:hover {
            background-color: #45a049;
        }
        .quiz-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        .quiz-result.correct {
            color: #2a6a2d;
            background-color: #e9f5e9;
            border: 1px solid #a3d9a5;
        }
        .quiz-result.incorrect {
            color: #a94442;
            background-color: #f2dede;
            border: 1px solid #ebccd1;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ソフトウェアテスト学習ガイド</h1>

        <h2>1. はじめに：なぜテストが重要なのか？</h2>
        <p>
            ソフトウェア開発におけるテストは、アプリケーションが期待通りに動作することを保証し、バグや問題を早期に発見するために不可欠です。良いテストは、コードの品質を高め、将来の変更や機能追加を容易にします。安心して開発を進めるための「セーフティネット」の役割を果たします。
        </p>

        <h2>2. テストの主な種類と実践例</h2>
        <p>テストは、検証する範囲や目的に応じて、いくつかのレベルに分類されます。ここでは代表的な3つのテストについて、具体的なコード例を交えながら詳しく見ていきましょう。</p>

        <h3>単体テスト (Unit Test)</h3>
        <p>
            単体テストは、関数やクラスといったソフトウェアの「最小単位」が、個々の機能として正しく動作するかを検証します。他の部分から完全に独立させてテストを行うため、問題の特定が非常に簡単で、修正も迅速に行えます。
        </p>
        <p><strong>例: ユーザー情報をフォーマットする関数のテスト (Jestを使用)</strong></p>
        <p>ユーザーオブジェクトを受け取り、名前と年齢を含む文字列を返すシンプルな関数を考えます。</p>
        <p><strong>テスト対象のコード (<code>user.js</code>)</strong></p>
        <pre><code>function formatUser(user) {
    if (!user || typeof user.name !== 'string' || typeof user.age !== 'number') {
        throw new Error('Invalid user object');
    }
    return `${user.name} (${user.age}歳)`;
}

module.exports = formatUser;</code></pre>

        <p><strong>テストコード (<code>user.test.js</code>)</strong></p>
        <pre><code>const formatUser = require('./user');

// テストケースをグループ化
describe('formatUser', () => {
    // 正常系のテスト
    test('should return formatted string with valid user', () => {
        const user = { name: 'Alice', age: 30 };
        // formatUserの結果が 'Alice (30歳)' になることを期待
        expect(formatUser(user)).toBe('Alice (30歳)');
    });

    // 異常系のテスト: 不正な入力
    test('should throw an error if user is null', () => {
        // 関数がエラーを投げることを期待
        expect(() => formatUser(null)).toThrow('Invalid user object');
    });

    test('should throw an error if name is missing', () => {
        const user = { age: 25 };
        expect(() => formatUser(user)).toThrow('Invalid user object');
    });
});</code></pre>
        <p>
            このテストでは、Jestというフレームワークを使い、<code>describe</code>でテストのグループを定義し、<code>test</code>（または<code>it</code>）で個別のテストケースを記述します。<code>expect</code>と<code>.toBe()</code>や<code>.toThrow()</code>といった「マッチャー」を組み合わせて、関数の結果が期待通りであるか、あるいは特定の条件下でエラーを投げるかを検証します。
        </p>

        <h3>結合テスト (Integration Test)</h3>
        <p>
            結合テストは、複数のコンポーネント（単位）を組み合わせたときに、それらがうまく連携して動作するかを検証します。例えば、「APIを呼び出すモジュール」と「そのデータを処理するモジュール」を繋ぎ合わせてテストします。
        </p>
        <p><strong>例: ユーザー情報をAPIから取得して表示する機能のテスト</strong></p>
        <p>ここでは、外部APIからユーザーデータを取得する<code>fetchUser</code>関数と、それを使ってユーザー情報を表示する<code>displayUser</code>関数の連携をテストします。実際のAPIを叩くとテストが不安定になるため、API通信部分は「モック」という偽物に置き換えます。</p>
        <p><strong>テスト対象のコード (<code>userAPI.js</code>, <code>userDisplay.js</code>)</strong></p>
        <pre><code>// userAPI.js - 外部APIと通信するモジュール
const axios = require('axios');

async function fetchUser(userId) {
    const response = await axios.get(`https://api.example.com/users/${userId}`);
    return response.data;
}

module.exports = { fetchUser };

// userDisplay.js - データを画面に表示する（という想定の）モジュール
const { fetchUser } = require('./userAPI');

async function displayUser(userId) {
    try {
        const user = await fetchUser(userId);
        return `ユーザー名: ${user.name}`;
    } catch (error) {
        return 'ユーザーの取得に失敗しました';
    }
}

module.exports = { displayUser };
</code></pre>

        <p><strong>テストコード (<code>userDisplay.test.js</code>)</strong></p>
        <pre><code>const { displayUser } = require('./userDisplay');
const { fetchUser } = require('./userAPI');

// userAPIモジュールのfetchUser関数をモック化
jest.mock('./userAPI');

describe('displayUser', () => {
    test('should display user name when API call is successful', async () => {
        // モックが返す偽のデータを設定
        const mockUser = { id: 1, name: 'Bob' };
        fetchUser.mockResolvedValue(mockUser);

        const result = await displayUser(1);
        expect(result).toBe('ユーザー名: Bob');
        // fetchUserが正しい引数で呼び出されたかを確認
        expect(fetchUser).toHaveBeenCalledWith(1);
    });

    test('should display error message when API call fails', async () => {
        // モックがエラーを返すように設定
        fetchUser.mockRejectedValue(new Error('API Error'));

        const result = await displayUser(1);
        expect(result).toBe('ユーザーの取得に失敗しました');
    });
});</code></pre>
        <p>
            <code>jest.mock('./userAPI')</code>で、<code>userAPI.js</code>のすべての関数が自動的にモックに置き換えられます。<code>fetchUser.mockResolvedValue(mockUser)</code>のように、そのモックがどのような値（この場合は成功時のユーザーデータ）を返すかをテストケースごとに設定することで、外部APIに依存しない安定したテストを実現しています。
        </p>

        <h3>E2Eテスト (End-to-End Test)</h3>
        <p>
            E2Eテストは、アプリケーション全体を、実際のユーザーと同じように操作してテストします。フロントエンドからバックエンド、データベースまで含めたシステム全体が、一連のシナリオ通りに正しく動作するかを検証します。
        </p>
        <p><strong>例: ログイン画面からログインし、ダッシュボードにリダイレクトされるかのテスト (Cypressを使用)</strong></p>
        <p>Cypressは、実際のブラウザを自動操作してテストを実行します。テストコードは、人間が操作する手順をそのまま記述するように書くことができます。</p>
        <p><strong>テストコード (<code>login.cy.js</code>)</strong></p>
        <pre><code>describe('Login Flow', () => {
    it('should log in successfully and redirect to the dashboard', () => {
        // 1. ログインページにアクセス
        cy.visit('/login');

        // 2. メールアドレスとパスワードを入力
        // cy.get()で要素を取得し、.type()で文字を入力
        cy.get('input[name="email"]').type('test@example.com');
        cy.get('input[name="password"]').type('password123');

        // 3. ログインボタンをクリック
        cy.get('button[type="submit"]').click();

        // 4. URLがダッシュボードに変わったことを確認
        cy.url().should('include', '/dashboard');

        // 5. ダッシュボードに「ようこそ」というテキストが表示されていることを確認
        cy.contains('h1', 'ようこそ、テストユーザーさん');
    });
});</code></pre>
        <p>
            このテストは、<code>cy.visit</code>でページを開き、<code>cy.get</code>でDOM要素を取得、<code>.type()</code>や<code>.click()</code>で操作を行い、<code>.should()</code>や<code>cy.contains()</code>で結果を検証するという、非常に直感的で分かりやすい流れになっています。これにより、ユーザーが実際に体験する一連の操作が、期待通りに機能することを保証します。
        </p>

        <h2>4. 代表的なテストツール</h2>
        <ul>
            <li><strong>Jest:</strong> Facebookが開発した、JavaScriptのテストフレームワーク。設定が簡単で、オールインワンなのが特徴です。</li>
            <li><strong>Mocha:</strong> Node.jsやブラウザで動作する、柔軟性の高いテストフレームワーク。アサーションライブラリ（Chaiなど）と組み合わせて使います。</li>
            <li><strong>Cypress:</strong> E2Eテストに特化したツール。実際のブラウザ上でテストが実行される様子を視覚的に確認できます。</li>
            <li><strong>JUnit:</strong> Javaの世界で最も広く使われている単体テストフレームワーク。</li>
            <li><strong>Pytest:</strong> Pythonのテストフレームワーク。シンプルで書きやすく、多くのプラグインで拡張可能です。</li>
        </ul>

        <h2>5. まとめ</h2>
        <p>
            テストは品質を保つための重要な活動です。まずは身近な言語の単体テストから始めて、少しずつテストを書く習慣を身につけていきましょう。
        </p>

        <hr>

        <h2>理解度チェッククイズ</h2>
        <div id="quiz-container">
            <div class="quiz-question">
                <h3>問題1</h3>
                <p>「個々の関数やクラスなど、ソフトウェアの最小単位の機能を検証するテスト」は次のうちどれですか？</p>
                <div class="quiz-options">
                    <label><input type="radio" name="q1" value="unit"> 単体テスト</label><br>
                    <label><input type="radio" name="q1" value="integration"> 結合テスト</label><br>
                    <label><input type="radio" name="q1" value="e2e"> E2Eテスト</label><br>
                </div>
                <button onclick="checkAnswer('q1', 'unit')">回答を確認</button>
                <p class="quiz-result" id="result-q1"></p>
            </div>
            <!-- More questions can be added here -->
        </div>
    </div>

    <script>
        function checkAnswer(questionName, correctAnswer) {
            const selectedOption = document.querySelector(`input[name="${questionName}"]:checked`);
            const resultElement = document.getElementById(`result-${questionName}`);

            if (!selectedOption) {
                resultElement.textContent = '答えを選択してください。';
                resultElement.className = 'quiz-result incorrect';
                return;
            }

            if (selectedOption.value === correctAnswer) {
                resultElement.textContent = '正解！素晴らしい！';
                resultElement.className = 'quiz-result correct';
            } else {
                resultElement.textContent = '不正解。もう一度、解説を読んでみましょう！';
                resultElement.className = 'quiz-result incorrect';
            }
        }
    </script>
</body>
</html>